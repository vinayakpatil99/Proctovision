<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin - Exams</title>
<link rel="icon" type="image/png" href="../images/logoprocto.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* RESET */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}

body {
  display: flex;
  min-height: 100vh;
  background: #f4f6fb;
  color: #333;
}

/* SIDEBAR */
.sidebar {
  width: 250px;
  background: linear-gradient(180deg, #2a2e5c, #3f51b5);
  color: #fff;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
}
.sidebar h2 {
  text-align: center;
  margin: 1.5em 0;
  font-size: 1.8em;
  font-weight: 700;
  letter-spacing: 1px;
}
.sidebar nav a {
  display: flex;
  align-items: center;
  padding: 1em 2em;
  color: #fff;
  text-decoration: none;
  font-weight: 500;
  border-left: 4px solid transparent;
  transition: all 0.3s ease;
}
.sidebar nav a i {
  margin-right: 10px;
  font-size: 1.2em;
}
.sidebar nav a.active,
.sidebar nav a:hover {
  background: rgba(255, 255, 255, 0.15);
  border-left: 4px solid #ff4081;
}

/* MAIN CONTENT */
.main-content {
  flex: 1;
  padding: 2em;
  background: #f4f6fb;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2em;
}
header h1 {
  font-size: 1.8em;
  color: #3f51b5;
  font-weight: 700;
}

/* SECTIONS */
.create-section, .exam-list, .assign-section {
  background: #fff;
  padding: 2em;
  border-radius: 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  margin-bottom: 2em;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.create-section:hover, .exam-list:hover, .assign-section:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 18px rgba(0,0,0,0.15);
}
.create-section h2, .exam-list h2, .assign-section h2 {
  color: #3f51b5;
  font-size: 1.3em;
  font-weight: 600;
  margin-bottom: 1em;
}

/* FORM ELEMENTS */
label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: #444;
}
input[type="text"], input[type="number"], input[type="date"], select {
  width: 100%;
  padding: 12px 14px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: #fafafa;
  color: #333;
  font-size: 1rem;
  transition: all 0.3s ease;
}
input:focus, select:focus {
  outline: none;
  border-color: #3f51b5;
  box-shadow: 0 0 6px rgba(63,81,181,0.3);
}

/* BUTTONS */
button {
  background: linear-gradient(90deg, #ff4081, #f50057);
  color: #fff;
  padding: 12px 25px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover {
  background: linear-gradient(90deg, #f50057, #d81b60);
  transform: translateY(-2px);
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  border-radius: 8px;
  overflow: hidden;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
th, td {
  padding: 14px 18px;
  text-align: left;
  color: #333;
  font-size: 0.95em;
}
th {
  background: #3f51b5;
  color: #fff;
  font-weight: 600;
}
tr:nth-child(even) {
  background: #f9f9ff;
}
tr:hover {
  background: #eef1ff;
  transition: background 0.3s ease;
}

/* MULTI-SELECT */
select[multiple] {
  height: 150px;
}

/* LOGOUT MODAL */
#logoutModal {
  display:none;
  position:fixed;
  z-index:1000;
  left:0; top:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}
#logoutModal>div {
  background:#fff;
  padding:2em;
  border-radius:12px;
  max-width:400px;
  width:90%;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,0.3);
}
#logoutModal h3 {
  color:#3f51b5;
  font-size:1.4em;
  margin-bottom:.5em;
}
#logoutModal p {
  color:#555;
  margin-bottom:1.5em;
}
#logoutModal button {
  padding:.7em 1.5em;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}
#cancelLogout {
  background:#ccc;
  color:#333;
}
#confirmLogout {
  background:#f44336;
  color:#fff;
}
#cancelLogout:hover {background:#bdbdbd;}
#confirmLogout:hover {background:#d32f2f;}

/* RESPONSIVE */
@media(max-width:768px){
  body{flex-direction:column;}
  .sidebar{width:100%;flex-direction:row;overflow-x:auto;}
  .sidebar nav a{flex:1;justify-content:center;padding:.8em;}
}
</style>
</head>
<body>

<!-- LOGOUT MODAL -->
<div id="logoutModal">
  <div>
    <h3>Confirm Logout</h3>
    <p>Are you sure you want to log out?</p>
    <div style="display:flex;justify-content:center;gap:15px;">
      <button id="cancelLogout">Cancel</button>
      <button id="confirmLogout">Logout</button>
    </div>
  </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>Admin</h2>
  <nav>
    <a href="dashboard.html"><i>üè†</i>Dashboard</a>
    <a href="exams.html" class="active"><i>üìù</i>Exams</a>
    <a href="questions.html"><i>‚ùì</i>All Questions</a>
    <a href="add-question.html"><i>‚ûï</i>Add Question</a>
    <a href="results.html"><i>üìä</i>Results</a>
    <a href="proctoring.html"><i>üé•</i>Proctoring</a>
    <a href="../login.html" id="logoutBtn"><i>üö™</i>Logout</a>
  </nav>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">
  <header>
    <h1>Manage Exams</h1>
  </header>

  <div class="create-section">
    <h2>Create New Exam</h2>
    <label>Title:</label>
    <input type="text" id="exam-title" placeholder="Enter exam title">
    <label>Date:</label>
    <input type="date" id="exam-date">
    <label>Duration (minutes):</label>
    <input type="number" id="exam-duration" placeholder="Duration">
    <button onclick="createExam()">Create Exam</button>
  </div>

  <div class="exam-list">
    <h2>All Exams</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Date</th>
          <th>Duration</th>
        </tr>
      </thead>
      <tbody id="exam-table-body"></tbody>
    </table>
  </div>

  <div class="assign-section">
    <h2>Assign Exam to Students</h2>
    <label>Select Exam:</label>
    <select id="exam-select"></select>
    <label>Select Students (Ctrl+Click):</label>
    <select id="student-select" multiple></select>
    <button onclick="assignExam()">Assign Exam</button>
  </div>
</div>

<script>
// === JS logic remains exactly the same ===
const examTableBody=document.getElementById('exam-table-body');
const examSelect=document.getElementById('exam-select');
const studentSelect=document.getElementById('student-select');

async function loadExams(){
  const res=await fetch('/api/admin/exams');
  const exams=await res.json();
  examTableBody.innerHTML='';
  examSelect.innerHTML='';
  exams.forEach(exam=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${exam.id}</td><td>${exam.title}</td><td>${exam.examDate}</td><td>${exam.durationMinutes}</td>`;
    examTableBody.appendChild(tr);
    const option=document.createElement('option');
    option.value=exam.id;
    option.textContent=exam.title;
    examSelect.appendChild(option);
  });
}

async function loadStudents(){
  const res=await fetch('/api/admin/students');
  const students=await res.json();
  studentSelect.innerHTML='';
  students.forEach(student=>{
    const option=document.createElement('option');
    option.value=student.id;
    option.textContent=student.username+" ("+student.email+")";
    studentSelect.appendChild(option);
  });
}

async function createExam(){
  const title=document.getElementById('exam-title').value;
  const date=document.getElementById('exam-date').value;
  const duration=parseInt(document.getElementById('exam-duration').value);
  if(!title||!date||!duration){alert('Please fill all fields');return;}
  const res=await fetch('/api/admin/exams',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({title,examDate:date,durationMinutes:duration})
  });
  if(res.ok){alert('Exam created successfully');loadExams();}
  else{const err=await res.text();alert('Failed to create exam: '+err);}
}

async function assignExam(){
  const examId=examSelect.value;
  const studentIds=Array.from(studentSelect.selectedOptions).map(opt=>parseInt(opt.value));
  if(!examId||studentIds.length===0){alert('Please select an exam and at least one student');return;}
  const res=await fetch(`/api/admin/exams/${examId}/assign`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(studentIds)
  });
  if(res.ok){alert('Exam assigned successfully');}
  else{const err=await res.text();alert('Failed to assign exam: '+err);}
}

loadExams();
loadStudents();

// === Logout Modal ===
const logoutBtn=document.getElementById("logoutBtn");
const logoutModal=document.getElementById("logoutModal");
const cancelLogout=document.getElementById("cancelLogout");
const confirmLogout=document.getElementById("confirmLogout");

logoutBtn.addEventListener("click",e=>{
  e.preventDefault();
  logoutModal.style.display="flex";
});
cancelLogout.addEventListener("click",()=>logoutModal.style.display="none");
confirmLogout.addEventListener("click",()=>{
  localStorage.clear();
  logoutModal.style.display="none";
  window.location.href="../login.html";
});
window.addEventListener("click",e=>{
  if(e.target===logoutModal)logoutModal.style.display="none";
});
</script>
</body>
</html>
